(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1911:(e,s,t)=>{Promise.resolve().then(t.bind(t,7709))},7709:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>S});var a=t(5155),l=t(2115),i=t(2596),r=t(9688);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,i.$)(s))}let d=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:n("rounded-lg border bg-card text-card-foreground shadow-sm",t),...l})});d.displayName="Card",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:n("flex flex-col space-y-1.5 p-6",t),...l})}).displayName="CardHeader",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:n("text-2xl font-semibold leading-none tracking-tight",t),...l})}).displayName="CardTitle",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:n("text-sm text-muted-foreground",t),...l})}).displayName="CardDescription";let c=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:n("p-6 pt-0",t),...l})});c.displayName="CardContent",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:n("flex items-center p-6 pt-0",t),...l})}).displayName="CardFooter";let o=l.forwardRef((e,s)=>{let{className:t,type:l,...i}=e;return(0,a.jsx)("input",{type:l,className:n("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...i})});o.displayName="Input";var m=t(235),u=t(7924),x=t(9074),f=t(2473);let h=f.bL,p=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(f.B8,{ref:s,className:n("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...l})});p.displayName=f.B8.displayName;let j=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(f.l9,{ref:s,className:n("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...l})});j.displayName=f.l9.displayName;let y=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(f.UC,{ref:s,className:n("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...l})});y.displayName=f.UC.displayName;var b=t(1918),v=t(6474),N=t(7863),g=t(5196);let w=b.bL;b.YJ;let C=b.WT,k=l.forwardRef((e,s)=>{let{className:t,children:l,...i}=e;return(0,a.jsxs)(b.l9,{ref:s,className:n("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[l,(0,a.jsx)(b.In,{asChild:!0,children:(0,a.jsx)(v.A,{className:"h-4 w-4 opacity-50"})})]})});k.displayName=b.l9.displayName;let P=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(b.PP,{ref:s,className:n("flex cursor-default items-center justify-center py-1",t),...l,children:(0,a.jsx)(N.A,{className:"h-4 w-4"})})});P.displayName=b.PP.displayName;let R=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(b.wn,{ref:s,className:n("flex cursor-default items-center justify-center py-1",t),...l,children:(0,a.jsx)(v.A,{className:"h-4 w-4"})})});R.displayName=b.wn.displayName;let A=l.forwardRef((e,s)=>{let{className:t,children:l,position:i="popper",...r}=e;return(0,a.jsx)(b.ZL,{children:(0,a.jsxs)(b.UC,{ref:s,className:n("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[(0,a.jsx)(P,{}),(0,a.jsx)(b.LM,{className:n("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,a.jsx)(R,{})]})})});A.displayName=b.UC.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(b.JU,{ref:s,className:n("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...l})}).displayName=b.JU.displayName;let O=l.forwardRef((e,s)=>{let{className:t,children:l,...i}=e;return(0,a.jsxs)(b.q7,{ref:s,className:n("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(b.VF,{children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})}),(0,a.jsx)(b.p4,{children:l})]})});O.displayName=b.q7.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(b.wv,{ref:s,className:n("-mx-1 my-1 h-px bg-muted",t),...l})}).displayName=b.wv.displayName;var _=t(5561),E=t(760);function S(){let[e,s]=(0,l.useState)([]),[t,i]=(0,l.useState)(""),[r,n]=(0,l.useState)(null),[f,b]=(0,l.useState)(!0),[v,N]=(0,l.useState)(null),[g,P]=(0,l.useState)(""),[R,S]=(0,l.useState)(!1),[T,M]=(0,l.useState)(0),U="#3498db",F="#2c3e50",z="#e6f2ff",B="#85b8e8",H="#003366",I={圣遗物:"#34495e",矿物:"#4CAF50",食材:"#f39c12",其他:"#bdc3c7"},J=["#3498db","#27ae60","#f39c12","#9b59b6","#e74c3c","#1abc9c","#d35400","#2980b9","#8e44ad","#c0392b"];(0,l.useEffect)(()=>{(async()=>{try{b(!0);let e=await fetch("/api/LogList");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=(await e.json()).list||[],a=Array.isArray(t)?t.map(e=>({value:e,label:e})):[];s(a),a.length>0&&i(a[0].value),N(null)}catch(e){console.error("Error fetching date list:",e),N("获取日期列表失败，请稍后再试")}finally{b(!1)}})()},[]),(0,l.useEffect)(()=>{(async()=>{if(t)try{b(!0);let e=await fetch("/api/analyse?date=".concat(t));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=await e.json();n(s),N(null)}catch(e){console.error("Error fetching data:",e),N("获取数据失败，请稍后再试")}finally{b(!1)}})()},[t]);let V=e=>e.includes("冒险家")||e.includes("游医")||e.includes("幸运儿")||e.includes("险家")||e.includes("医的")||e.includes("运儿")||e.includes("家")||e.includes("的")&&(e.includes("方巾")||e.includes("枭羽")||e.includes("怀钟")||e.includes("药壶")||e.includes("银莲")||e.includes("怀表")||e.includes("尾羽")||e.includes("头带")||e.includes("金杯")||e.includes("之花")||e.includes("之杯")||e.includes("沙漏")||e.includes("绿花")||e.includes("银冠")||e.includes("鹰羽"))?"圣遗物":["铁块","白铁块","水晶块","魔晶块","星银矿石","紫晶块","萃凝晶"].includes(e)?"矿物":["苹果","蘑菇","甜甜花","胡萝卜","白萝卜","金鱼草","薄荷","松果","树莓","松茸","鸟蛋","海草","堇瓜","墩墩桃","须弥蔷薇","枣椰","茉洁草","沉玉仙茗","颗粒果","澄晶实","红果果菇","小灯草","嘟嘟莲","莲蓬","绝云椒椒","清心","马尾","琉璃袋","竹笋","绯樱绣球","树王圣体菇","帕蒂沙兰","青蜜莓"].includes(e)?"食材":"其他",q=e=>Object.entries(e).filter(e=>{let[s]=e;return s.toLowerCase().includes(g.toLowerCase())}).sort((e,s)=>s[1]-e[1]),D=e=>I[V(e)],W={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.5,when:"beforeChildren",staggerChildren:.1}},exit:{opacity:0,transition:{duration:.3,when:"afterChildren",staggerChildren:.05,staggerDirection:-1}}},Z={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{duration:.3}},exit:{y:-20,opacity:0,transition:{duration:.2}}},Q={hidden:{scale:.9,opacity:0},visible:{scale:1,opacity:1,transition:{duration:.4,type:"spring",stiffness:100}},exit:{scale:.9,opacity:0,transition:{duration:.3}}};if(f)return(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)(_.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},className:"text-xl flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-t-transparent border-primary rounded-full animate-spin mb-4"}),(0,a.jsx)("div",{children:"加载中..."})]})});if(v)return(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"text-xl text-red-500",children:["错误: ",v]})});if(!r)return(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsx)("div",{className:"text-xl",children:"无数据"})});let Y=(e=>{let s={圣遗物:{},矿物:{},食材:{},其他:{}};return Object.entries(e).forEach(e=>{let[t,a]=e;s[V(t)][t]=a}),s})(r.item_count),$=Object.values(r.item_count).reduce((e,s)=>e+s,0),G=Object.keys(r.item_count).length,K=Object.entries(r.item_count).sort((e,s)=>s[1]-e[1]).slice(0,5),X=(e=>{let s=[];return Object.entries(e).forEach(e=>{let[t,a]=e,l=Object.values(a).reduce((e,s)=>e+s,0);s.push({name:t,count:l,color:I[t]})}),s})(Y),ee=(e=>{let s=e.reduce((e,s)=>e+s.count,0),t=0;return e.map((e,a)=>{let l=e.count/s,i=t,r=t+2*l*Math.PI,n=100+80*Math.cos(i),d=100+80*Math.sin(i),c=100+80*Math.cos(r),o=100+80*Math.sin(r),m="M 100 100 L ".concat(n," ").concat(d," A 80 80 0 ").concat(+(l>.5)," 1 ").concat(c," ").concat(o," Z");return t=r,{path:m,color:e.color,name:e.name,count:e.count,percentage:(100*l).toFixed(1)}})})(X),es=K[0][1];return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8 bg-white",children:[(0,a.jsx)("h1",{className:"mb-8 text-3xl font-bold text-center",style:{color:F},children:"参量质变仪"}),(0,a.jsxs)(_.P.div,{variants:W,initial:"hidden",animate:"visible",className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsx)(_.P.div,{variants:Z,children:(0,a.jsx)(d,{className:"border-0 shadow-sm overflow-hidden",style:{backgroundColor:z},children:(0,a.jsxs)(c,{className:"flex items-center justify-between p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm",style:{color:F},children:"总物品数量"}),(0,a.jsx)("p",{className:"text-3xl font-bold",style:{color:H},children:$})]}),(0,a.jsx)(m.A,{className:"h-8 w-8",style:{color:U}})]})})}),(0,a.jsx)(_.P.div,{variants:Z,children:(0,a.jsx)(d,{className:"border-0 shadow-sm overflow-hidden",style:{backgroundColor:z},children:(0,a.jsxs)(c,{className:"flex items-center justify-between p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm",style:{color:F},children:"物品种类"}),(0,a.jsx)("p",{className:"text-3xl font-bold",style:{color:H},children:G})]}),(0,a.jsx)(m.A,{className:"h-8 w-8",style:{color:U}})]})})}),(0,a.jsx)(_.P.div,{variants:Z,children:(0,a.jsx)(d,{className:"border-0 shadow-sm overflow-hidden",style:{backgroundColor:z},children:(0,a.jsxs)(c,{className:"flex items-center justify-between p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm",style:{color:F},children:"最多物品"}),(0,a.jsx)("p",{className:"text-3xl font-bold",style:{color:H},children:Object.entries(r.item_count).sort((e,s)=>s[1]-e[1])[0][0]})]}),(0,a.jsx)(m.A,{className:"h-8 w-8",style:{color:U}})]})})})]}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8",children:[(0,a.jsxs)("div",{className:"w-full lg:w-1/3 space-y-8",children:[(0,a.jsx)(E.N,{mode:"wait",children:(0,a.jsx)(_.P.div,{variants:Q,initial:"hidden",animate:"visible",exit:"exit",children:(0,a.jsx)(d,{className:"border-0 shadow-sm overflow-hidden",children:(0,a.jsxs)(c,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",style:{color:F},children:"物品数量排行（前五个）"}),(0,a.jsx)("div",{className:"space-y-4",children:K.slice(0,5).map((e,s)=>{let[t,l]=e;return(0,a.jsxs)(_.P.div,{className:"flex flex-col",initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:.1*s,duration:.3},children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,a.jsx)("span",{className:"font-medium truncate",children:t}),(0,a.jsx)("span",{style:{color:F},children:l})]}),(0,a.jsx)("div",{className:"w-full bg-gray-100 rounded-full h-3",children:(0,a.jsx)(_.P.div,{initial:{width:0},animate:{width:"".concat(l/es*100,"%")},transition:{duration:.8,delay:.2+.1*s},className:"h-3 rounded-full",style:{backgroundColor:J[s%J.length]}})})]},s)})})]})})},"bar-chart-".concat(T))}),(0,a.jsx)(E.N,{mode:"wait",children:(0,a.jsx)(_.P.div,{variants:Q,initial:"hidden",animate:"visible",exit:"exit",children:(0,a.jsx)(d,{className:"border-0 shadow-sm overflow-hidden",children:(0,a.jsxs)(c,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",style:{color:F},children:"物品类别分布"}),(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)(_.P.div,{className:"relative w-[200px] h-[200px]",initial:{rotate:-90,opacity:0},animate:{rotate:0,opacity:1},transition:{duration:.8,type:"spring"},children:(0,a.jsx)("svg",{viewBox:"0 0 200 200",className:"w-full h-full",children:ee.map((e,s)=>(0,a.jsx)(_.P.path,{d:e.path,fill:e.color,stroke:"white",strokeWidth:"1",initial:{opacity:0},animate:{opacity:1},transition:{delay:.1*s,duration:.5}},s))})}),(0,a.jsx)("div",{className:"mt-6 grid grid-cols-2 gap-x-4 gap-y-3 w-full",children:X.map((e,s)=>(0,a.jsxs)(_.P.div,{className:"flex items-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3+.1*s,duration:.3},children:[(0,a.jsx)("div",{className:"w-4 h-4 mr-2 flex-shrink-0 rounded-sm",style:{backgroundColor:e.color}}),(0,a.jsxs)("div",{className:"flex justify-between w-full",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:e.name}),(0,a.jsxs)("span",{className:"text-sm",style:{color:F},children:[e.count," (",ee[s].percentage,"%)"]})]})]},s))})]})]})})},"pie-chart-".concat(T))})]}),(0,a.jsxs)("div",{className:"w-full lg:w-2/3",children:[(0,a.jsxs)("div",{className:"mb-8 p-6 rounded-lg",style:{backgroundColor:z},children:[(0,a.jsx)("div",{className:"mb-6 flex flex-col items-center gap-4",children:(0,a.jsxs)("div",{className:"relative w-full max-w-md",children:[(0,a.jsx)(u.A,{className:"absolute left-3 top-3 h-4 w-4",style:{color:U}}),(0,a.jsx)(o,{placeholder:"搜索物品...",className:"pl-10 py-6 border-0 shadow-sm focus:ring-2",style:{borderColor:B,boxShadow:"0 0 0 1px ".concat(B)},value:g,onChange:e=>P(e.target.value)})]})}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-4 w-4",style:{color:U}}),(0,a.jsx)("span",{className:"text-sm",style:{color:F},children:"选择日期:"})]}),(0,a.jsxs)(w,{value:t,onValueChange:e=>{e!==t&&(S(!0),setTimeout(()=>{i(e),M(e=>e+1),b(!0),setTimeout(()=>{b(!1),S(!1)},600)},300))},children:[(0,a.jsx)(k,{className:"w-[240px] border-0 shadow-sm focus:ring-2",style:{borderColor:B,boxShadow:"0 0 0 1px ".concat(B)},children:(0,a.jsx)(C,{placeholder:"选择日期"})}),(0,a.jsx)(A,{children:e.map(e=>(0,a.jsx)(O,{value:e.value,children:e.label},e.value))})]})]})]}),(0,a.jsxs)(h,{defaultValue:"all",className:"flex flex-col items-center",children:[(0,a.jsx)(_.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:(0,a.jsxs)(p,{className:"mb-6 p-1 rounded-md",style:{backgroundColor:"#f5f5f5"},children:[(0,a.jsx)(j,{value:"all",className:"data-[state=active]:text-white",style:{backgroundColor:"transparent",color:F,"--tw-data-state-active-bg":U},children:"全部"}),Object.keys(Y).map(e=>(0,a.jsx)(j,{value:e,className:"data-[state=active]:text-white",style:{backgroundColor:"transparent",color:F,"--tw-data-state-active-bg":U},children:e},e))]})}),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)(E.N,{mode:"wait",children:[(0,a.jsx)(y,{value:"all",children:(0,a.jsx)(_.P.div,{variants:W,initial:"hidden",animate:"visible",exit:"exit",className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3",children:q(r.item_count).map((e,s)=>{let[t,l]=e;return(0,a.jsx)(_.P.div,{variants:Z,children:(0,a.jsx)(L,{name:t,count:l,color:D(t)})},t)})},"all-items-".concat(T))}),Object.entries(Y).map(e=>{let[s,t]=e;return(0,a.jsx)(y,{value:s,children:(0,a.jsx)(_.P.div,{variants:W,initial:"hidden",animate:"visible",exit:"exit",className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3",children:q(t).map((e,t)=>{let[l,i]=e;return(0,a.jsx)(_.P.div,{variants:Z,children:(0,a.jsx)(L,{name:l,count:i,color:I[s]})},l)})},"".concat(s,"-items-").concat(T))},s)})]})})]})]})]})]})}function L(e){let{name:s,count:t,color:l}=e;return(0,a.jsx)(d,{className:"border border-gray-100 hover:shadow-md transition-shadow duration-200",children:(0,a.jsx)(c,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"truncate font-medium",children:s}),(0,a.jsx)("div",{className:"ml-2 rounded-full px-2 py-1 text-xs font-semibold text-white",style:{backgroundColor:l},children:t})]})})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[187,441,684,358],()=>s(1911)),_N_E=e.O()}]);